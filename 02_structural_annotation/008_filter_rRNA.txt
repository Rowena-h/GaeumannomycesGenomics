source eiwebapollo-latest && source bedtools-2.28.0_cs && source gffread-0.12.2_CBG && source mikado-master && for f in {Gt-19d1,Gt-4e,Gh-2C17,Gh-1B17,Gt-3aA1,Gt-8d,Gt-CB1,Gt14LH10,Gt-23d}; do cd ${f}/Analysis/minos-1.9.0-dev_polish/Inputs/Models/ ; mkdir -p filtered ; rm -rf *gtf; for j in *gff; do tag=$(echo $j | rev | cut -d . -f2- | rev );source  gffread-0.12.2_CBG && gffread -T -o ${tag}.gtf $j;done ; for i in *gtf;do tag=$(echo $i | rev | cut -d . -f2- | rev ); mkdir -p temp.${i}; cd temp.${i}; gffread --keep-genes -o ${i}.gff ../${i} && awk '$3 == "exon"' ${i}.gff > ${i}.exon; bedtools coverage -a ${i}.exon -b /ei/.project-scratch/d/d2c0bfb1-c37a-4211-9493-86b15d4e773e/CB-GENANNO-520_Mark_McMullan_Wheat_Take-all/Analysis/rnammer1.2/Inputs/${f}_rnammer.gff > ${i}.exon.coverage; cat ${i}.exon.coverage | cut -f9 | cut -d ";" -f1 | paste - ${i}.exon.coverage | sort -k1,1V | cut -f2-1000 > ${i}.exon.coverage.cbed; get_coverage_stats_for_transcripts_from_cbed_output_v4.pl ${i}.exon.coverage.cbed > ${i}.exon.coverage.cbed.trans_cov.txt ;  cat ../$i | awk '$3 == "transcript"' |cut -f9 |cut -d '"' -f2,4 |sed 's/\"/\t/' > $i.mrna_gene;cat ${i}.exon.coverage.cbed.trans_cov.txt | awk '$4 <= 20' | cut -f1 > ${i}.exon.coverage.cbed.trans_cov.filtered20.txt; grepf_gemy.pl ${i}.exon.coverage.cbed.trans_cov.filtered20.txt ${i}.mrna_gene > ${i}.mrna_gene_to_filter ; extract_from_GTF_GFF3 ${i}.mrna_gene_to_filter ${i}.gff > ${i}.filtered.gff ; cp ${i}.filtered.gff ../filtered/${tag}.filtered.gff; cd .. ; done ; mark ; done
